// Generated by CoffeeScript 1.10.0
define('admin/plugins/v2mm', ['admin/settings', 'admin/modules/colorpicker'], function(Settings, colorpicker) {
  var ACP, getItem;
  ACP = {};
  getItem = function(name) {
    return ajaxify.data.availabelLabels.find(function(item) {
      return item.name === name;
    });
  };
  ACP.init = function() {
    $("#create-label").on('keydown', function(e) {
      if (e.which === 13 && $(this).val()) {
        e.preventDefault();
        return socket.emit('plugins.v2mm.createTopicLabel', {
          value: $(this).val()
        }, ajaxify.refresh);
      }
    });
    $(".topic-label-li .remove").on("click", function(e) {
      var data;
      e.preventDefault();
      data = getItem($(this).closest('li').data('name'));
      return socket.emit('plugins.v2mm.removeTopicLabel', data, ajaxify.refresh);
    });
    $('.topic-label-li .color-picker').each(function() {
      var $el, k;
      $el = $(this);
      k = $(this).data('name');
      return colorpicker.enable($el, function(hsb, hex) {
        var cssName, v;
        v = $el.val();
        console.log("picker color: " + hex);
        cssName = k === 'color' ? 'color' : 'background-color';
        return $el.closest('li').find('.topic-label').css(cssName, v);
      });
    });
    $('.topic-label-li .save-label-item').on('click', function() {
      var $el, data;
      $el = $(this);
      data = getItem($(this).closest('li').data('name'));
      data.color = $(this).closest('li').find('.color').val();
      data.bkColor = $(this).closest('li').find('.bkColor').val();
      return socket.emit('plugins.v2mm.createTopicLabel', data, ajaxify.refresh);
    });
    return Settings.prepare();
  };
  return ACP;
});
